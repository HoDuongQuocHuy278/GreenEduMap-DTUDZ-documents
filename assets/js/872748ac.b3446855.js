"use strict";(self.webpackChunkgreenedumap_docs=self.webpackChunkgreenedumap_docs||[]).push([[561],{2579:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>o,frontMatter:()=>l,metadata:()=>t,toc:()=>d});var r=s(4848),i=s(8453);const l={},a="\ud83d\udd10 Auth Service",t={id:"Services/AuthService/Readme",title:"\ud83d\udd10 Auth Service",description:"\ud83d\udccb T\u1ed5ng quan",source:"@site/docs/Services/AuthService/Readme.md",sourceDirName:"Services/AuthService",slug:"/Services/AuthService/",permalink:"/GreenEduMap-DTUDZ-documents/Services/AuthService/",draft:!1,unlisted:!1,editUrl:"https://github.com/HoDuongQuocHuy278/GreenEduMap-DTUDZ-documents/edit/main/docs/Services/AuthService/Readme.md",tags:[],version:"current",frontMatter:{}},c={},d=[{value:"\ud83d\udccb T\u1ed5ng quan",id:"-t\u1ed5ng-quan",level:2},{value:"\ud83c\udfaf Ch\u1ee9c n\u0103ng ch\xednh",id:"-ch\u1ee9c-n\u0103ng-ch\xednh",level:2},{value:"\ud83d\udd11 Authentication",id:"-authentication",level:3},{value:"\ud83d\udc65 User Management",id:"-user-management",level:3},{value:"\ud83d\udd10 Authorization",id:"-authorization",level:3},{value:"\ud83d\udd04 Token Operations",id:"-token-operations",level:3},{value:"\ud83d\udd0c API Endpoints",id:"-api-endpoints",level:2},{value:"Authentication",id:"authentication",level:3},{value:"User Management",id:"user-management",level:3},{value:"API Keys",id:"api-keys",level:3},{value:"\ud83d\udcbe Database Schema",id:"-database-schema",level:2},{value:"users",id:"users",level:3},{value:"refresh_tokens",id:"refresh_tokens",level:3},{value:"api_keys",id:"api_keys",level:3},{value:"\ud83d\ude80 Setup",id:"-setup",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Docker Deployment",id:"docker-deployment",level:3},{value:"\ud83d\udce1 Usage Examples",id:"-usage-examples",level:2},{value:"Register User",id:"register-user",level:3},{value:"Login",id:"login",level:3},{value:"Get Current User",id:"get-current-user",level:3},{value:"\ud83d\udd12 Security Features",id:"-security-features",level:2},{value:"\ud83d\udcc4 License",id:"-license",level:2}];function h(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"-auth-service",children:"\ud83d\udd10 Auth Service"}),"\n",(0,r.jsx)(n.h2,{id:"-t\u1ed5ng-quan",children:"\ud83d\udccb T\u1ed5ng quan"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Ng\xf4n ng\u1eef l\u1eadp tr\xecnh:"})," Python 3.11 + FastAPI",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Port:"})," 8001",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Database:"})," PostgreSQL",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.strong,{children:"Tr\u1ea1ng th\xe1i:"})," \u2705 Ho\u1ea1t \u0111\u1ed9ng"]}),"\n",(0,r.jsxs)(n.p,{children:["Auth Service cung c\u1ea5p x\xe1c th\u1ef1c v\xe0 ph\xe2n quy\u1ec1n cho h\u1ec7 th\u1ed1ng ",(0,r.jsx)(n.strong,{children:"GreenEduMap"}),", s\u1eed d\u1ee5ng JWT tokens v\xe0 h\u1ed7 tr\u1ee3 nhi\u1ec1u vai tr\xf2 ng\u01b0\u1eddi d\xf9ng."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-ch\u1ee9c-n\u0103ng-ch\xednh",children:"\ud83c\udfaf Ch\u1ee9c n\u0103ng ch\xednh"}),"\n",(0,r.jsx)(n.h3,{id:"-authentication",children:"\ud83d\udd11 Authentication"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Registration & Login"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Email/username + password registration"}),"\n",(0,r.jsx)(n.li,{children:"Secure password hashing (bcrypt, 12 rounds)"}),"\n",(0,r.jsx)(n.li,{children:"Email verification (optional)"}),"\n",(0,r.jsx)(n.li,{children:"Account activation"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"JWT Token Management"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Access tokens (short-lived, 15 minutes)"}),"\n",(0,r.jsx)(n.li,{children:"Refresh tokens (long-lived, 7 days)"}),"\n",(0,r.jsx)(n.li,{children:"Token rotation on refresh"}),"\n",(0,r.jsx)(n.li,{children:"Automatic token expiration"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Password Security"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Bcrypt hashing algorithm"}),"\n",(0,r.jsx)(n.li,{children:"Salt generation per password"}),"\n",(0,r.jsx)(n.li,{children:"Password strength validation"}),"\n",(0,r.jsx)(n.li,{children:"Password reset flow"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-user-management",children:"\ud83d\udc65 User Management"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Roles"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"admin"})," - Full system access"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"developer"})," - API key management, development features"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"volunteer"})," - Rescue operations, community features"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"citizen"})," - Basic access, reporting"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"school"})," - Education features, school management"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"User Profile"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Email, username (unique)"}),"\n",(0,r.jsx)(n.li,{children:"Role assignment"}),"\n",(0,r.jsx)(n.li,{children:"Active/inactive status"}),"\n",(0,r.jsx)(n.li,{children:"Email verification status"}),"\n",(0,r.jsx)(n.li,{children:"Public/private profile flag (OpenData compliance)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-authorization",children:"\ud83d\udd10 Authorization"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Role-Based Access Control (RBAC)"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Permission checking middleware"}),"\n",(0,r.jsx)(n.li,{children:"Route protection by role"}),"\n",(0,r.jsx)(n.li,{children:"Resource-level permissions"}),"\n",(0,r.jsx)(n.li,{children:"Hierarchical role system"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"API Key Management"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generate API keys for developers"}),"\n",(0,r.jsx)(n.li,{children:"Scoped permissions per key"}),"\n",(0,r.jsx)(n.li,{children:"Rate limiting per key"}),"\n",(0,r.jsx)(n.li,{children:"Key revocation"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-token-operations",children:"\ud83d\udd04 Token Operations"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Access Token"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Contains: user_id, email, role"}),"\n",(0,r.jsx)(n.li,{children:"Expiration: 15 minutes"}),"\n",(0,r.jsx)(n.li,{children:"Used for API authentication"}),"\n",(0,r.jsx)(n.li,{children:"Stateless validation"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Refresh Token"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Stored in database"}),"\n",(0,r.jsx)(n.li,{children:"Expiration: 7 days"}),"\n",(0,r.jsx)(n.li,{children:"Rotation on use"}),"\n",(0,r.jsx)(n.li,{children:"Revocation support"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-api-endpoints",children:"\ud83d\udd0c API Endpoints"}),"\n",(0,r.jsx)(n.h3,{id:"authentication",children:"Authentication"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"POST /api/v1/auth/register\r\nPOST /api/v1/auth/login\r\nPOST /api/v1/auth/refresh\r\nGET  /api/v1/auth/me\r\nPOST /api/v1/auth/logout\n"})}),"\n",(0,r.jsx)(n.h3,{id:"user-management",children:"User Management"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"GET    /api/v1/users          # List users (Admin only)\r\nGET    /api/v1/users/{id}     # Get user by ID\r\nPUT    /api/v1/users/{id}     # Update user\r\nDELETE /api/v1/users/{id}     # Delete user (Admin only)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"api-keys",children:"API Keys"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"POST   /api/v1/api-keys       # Create API key (Developers)\r\nGET    /api/v1/api-keys       # List my API keys\r\nDELETE /api/v1/api-keys/{id}  # Revoke API key\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-database-schema",children:"\ud83d\udcbe Database Schema"}),"\n",(0,r.jsx)(n.h3,{id:"users",children:"users"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE users (\r\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\r\n    email VARCHAR(255) UNIQUE NOT NULL,\r\n    username VARCHAR(100) UNIQUE NOT NULL,\r\n    password_hash VARCHAR(255) NOT NULL,\r\n    role VARCHAR(50) NOT NULL DEFAULT 'citizen',\r\n    is_active BOOLEAN DEFAULT true,\r\n    is_verified BOOLEAN DEFAULT false,\r\n    is_public BOOLEAN DEFAULT true,\r\n    created_at TIMESTAMP DEFAULT NOW(),\r\n    updated_at TIMESTAMP DEFAULT NOW()\r\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"refresh_tokens",children:"refresh_tokens"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE refresh_tokens (\r\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\r\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\r\n    token_hash VARCHAR(255) NOT NULL,\r\n    expires_at TIMESTAMP NOT NULL,\r\n    is_revoked BOOLEAN DEFAULT false,\r\n    created_at TIMESTAMP DEFAULT NOW()\r\n);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"api_keys",children:"api_keys"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE api_keys (\r\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\r\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\r\n    key_hash VARCHAR(255) NOT NULL,\r\n    scopes TEXT,\r\n    rate_limit INTEGER DEFAULT 1000,\r\n    created_at TIMESTAMP DEFAULT NOW()\r\n);\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-setup",children:"\ud83d\ude80 Setup"}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"# Auth Service\r\nAUTH_SERVICE_HOST=0.0.0.0\r\nAUTH_SERVICE_PORT=8001\r\n\r\n# Database\r\nDATABASE_URL=postgresql+asyncpg://user:pass@postgres:5432/greenedumap\r\n\r\n# JWT Configuration\r\nJWT_SECRET_KEY=your-secret-key-here\r\nJWT_ALGORITHM=HS256\r\nACCESS_TOKEN_EXPIRE_MINUTES=15\r\nREFRESH_TOKEN_EXPIRE_DAYS=7\r\n\r\n# Password Hashing\r\nBCRYPT_ROUNDS=12\n"})}),"\n",(0,r.jsx)(n.h3,{id:"docker-deployment",children:"Docker Deployment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'auth-service:\r\n  build: ./modules/auth-service\r\n  ports:\r\n    - "8001:8001"\r\n  depends_on:\r\n    - postgres\r\n  environment:\r\n    - DATABASE_URL=postgresql+asyncpg://user:pass@postgres:5432/greenedumap\r\n    - JWT_SECRET_KEY=${JWT_SECRET_KEY}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-usage-examples",children:"\ud83d\udce1 Usage Examples"}),"\n",(0,r.jsx)(n.h3,{id:"register-user",children:"Register User"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8001/api/v1/auth/register \\\r\n  -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "email": "user@example.com",\r\n    "username": "johndoe",\r\n    "password": "SecurePass123!",\r\n    "role": "citizen"\r\n  }\'\n'})}),"\n",(0,r.jsx)(n.h3,{id:"login",children:"Login"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8001/api/v1/auth/login \\\r\n  -H "Content-Type: application/json" \\\r\n  -d \'{\r\n    "email": "user@example.com",\r\n    "password": "SecurePass123!"\r\n  }\'\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Response:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\r\n  "access_token": "eyJhbGciOiJIUzI1NiIs...",\r\n  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",\r\n  "token_type": "bearer",\r\n  "expires_in": 900\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"get-current-user",children:"Get Current User"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl http://localhost:8001/api/v1/auth/me \\\r\n  -H "Authorization: Bearer <access_token>"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-security-features",children:"\ud83d\udd12 Security Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Password Hashing"}),": Bcrypt with 12 rounds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"JWT Tokens"}),": Signed with HS256 algorithm"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token Expiration"}),": Short-lived access tokens"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Refresh Token Rotation"}),": New token on each refresh"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API Key Hashing"}),": Stored as hashed values"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rate Limiting"}),": Per-user and per-API-key limits"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"-license",children:"\ud83d\udcc4 License"}),"\n",(0,r.jsxs)(n.p,{children:["D\u1ef1 \xe1n n\xe0y \u0111\u01b0\u1ee3c ph\xe2n ph\u1ed1i d\u01b0\u1edbi ",(0,r.jsx)(n.a,{href:"https://github.com/HoDuongQuocHuy278/GreenEduMap-DTUDZ/blob/main/LICENSE",children:"GNU General Public License v3.0"}),"."]})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>t});var r=s(6540);const i={},l=r.createContext(i);function a(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);